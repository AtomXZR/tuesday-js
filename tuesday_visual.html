<!doctype html>
<html>
<head>
	<title>Tuesday js visual editor</title>
	<link rel="shortcut icon" href="icon.jpg" type="image/x-icon">
    <meta charset="UTF-8">
    <style>
	*{
		font-family: Arial;
		border-collapse: collapse;
		border: none;
		margin: 0;
		padding: 0;
		border: 0;
		border-spacing: 0px;
		-webkit-touch-callout: none;
		-webkit-user-select: none;
		-khtml-user-select: none;
		-moz-user-select: none;
		-ms-user-select: none;
		user-select: none;
        outline: none;
	}
	.panel {
		background-color: #fff;
		box-shadow: 0px 2px 24px rgba(110,95,165,0.25);
		border-radius: 16px;
	}
	@keyframes flash {
		0% {box-shadow: 0px 2px 32px rgba(90,75,145,1); background-color: #cec8e3;}
        25% {box-shadow: 0px 2px 32px rgba(90,75,145,1); background-color: #cec8e3;}
		100% {box-shadow: 0px 2px 24px rgba(110,95,165,0.25); background-color: #fff;}
	}
	.story_block {
		 min-height: 28px;
		 width:256px;
		 position: absolute;
		 cursor: all-scroll;
	}
	#world {
		 position: absolute;
	}
	line {
		stroke:#6e5fa5;
		stroke-dasharray: 20;
		stroke-width:2;
		animation: dash 4s linear infinite;
	}

	@keyframes dash {
	  from {
		stroke-dashoffset: 0
	  }
	  to {
		stroke-dashoffset: 200;
	  }
	}
	#menu_panel {
		z-index: 1000;
		top:0; 
		left:0; 
		background-color: #fff;
		box-shadow: 0px 2px 24px rgba(110,95,165,0.25);
		border-radius: 0 0 16px 0;
		position: fixed; 
		height: 40px;
		width: 480px;
	}
	.button_block {
		height: 26px;
		width: 26px;
		background-size: 70% 70%;
		background-repeat: no-repeat;
		background-position: center;
	}
	.icon {
		background-size: 22px 22px;
		background-repeat: no-repeat;
		background-position: center;
	}
	.button_menu {
		background-position: center;
	}
	.button_menu:hover {
		background-color: #cec8e3;
	}
	.icon_new {
		background-image: url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCAyNTYgMjU2Ij4NCiAgPHBhdGggZmlsbD0ibm9uZSIgZmlsbC1vcGFjaXR5PSIwIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMTIiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGQ9Ik0yMjMsNTIuNjZWMjQ5SDM1VjZIMTc2LjM0WiIvPg0KICA8cGF0aCBmaWxsPSJub25lIiBmaWxsLW9wYWNpdHk9IjAiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIxMiIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgZD0iTTIyMyw1M0gxNzZWNiIvPg0KPC9zdmc+DQo=")
	}
	.icon_load {
		background-image: url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCAyNTYgMjU2Ij4NCiAgPHBhdGggZmlsbD0ibm9uZSIgZmlsbC1vcGFjaXR5PSIwIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMTIiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGQ9Ik00OC4xMTYsODUuMzc0SDI1MS45OTFMMjA4Ljg3NSwyMjZINVoiLz4NCiAgPHBhdGggZmlsbD0ibm9uZSIgZmlsbC1vcGFjaXR5PSIwIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMTIiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGQ9Ik00OC4xMTYsODUuMzc0TDUsMjI2VjUxLjMyNUwxOC43LDM0SDY1LjQ0NWwxMy43LDE3LjMyNUgyMDguODc1Vjg1LjM3NEg0OC4xMTZaIi8+DQo8L3N2Zz4NCg==")
	}
	.icon_save {
		background-image: url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCAyNTYgMjU2Ij4NCiAgPHBhdGggZmlsbD0ibm9uZSIgZmlsbC1vcGFjaXR5PSIwIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMTIiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGQ9Ik0yMzgsNTEuOTE5VjIyOGExMCwxMCwwLDAsMS0xMCwxMEgyN2ExMCwxMCwwLDAsMS0xMC0xMFYyN0ExMCwxMCwwLDAsMSwyNywxN0gyMDMuMTE4WiIvPg0KICA8cGF0aCBmaWxsPSJub25lIiBmaWxsLW9wYWNpdHk9IjAiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIxMiIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgZD0iTTM5LDIzOFYxMjdhMTAsMTAsMCwwLDEsMTAtMTBIMjA1YTEwLDEwLDAsMCwxLDEwLDEwVjIzOEgzOVpNMTc0LjIsOTUuNjVINzkuOGExMCwxMCwwLDAsMS0xMC0xMFYxN0gxODQuMlY4NS42NUExMCwxMCwwLDAsMSwxNzQuMiw5NS42NVpNMTY4LDQyYTEwLDEwLDAsMCwwLTEwLTEwSDE0NGExMCwxMCwwLDAsMC0xMCwxMFY3MWExMCwxMCwwLDAsMCwxMCwxMGgxNGExMCwxMCwwLDAsMCwxMC0xMFY0MloiLz4NCiAgPHBhdGggZmlsbD0ibm9uZSIgZmlsbC1vcGFjaXR5PSIwIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMTIiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGQ9Ik02MywxNjJIMTkybTAsNDlINjMiLz4NCjwvc3ZnPg0K")
	}
	.icon_play {
		background-image: url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCAyNTYgMjU2Ij4NCiAgPHBhdGggZmlsbD0ibm9uZSIgZmlsbC1vcGFjaXR5PSIwIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMTIiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGQ9Ik03LDI0TDI0OCwxMjYuODg2VjEyOEw3LDIzMC44ODZWMjRaIi8+DQo8L3N2Zz4NCg==")
	}
	.icon_edit {
		background-image: url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCAyNTYgMjU2Ij4NCiAgPHBhdGggZmlsbD0ibm9uZSIgZmlsbC1vcGFjaXR5PSIwIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMTIiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGQ9Ik0xNTAuNSw0NC43MWg2MC4wM2EyMCwyMCwwLDAsMSwyMCwyMFYyMjcuNjNhMjAsMjAsMCwwLDEtMjAsMjBINDYuNDdhMjAsMjAsMCwwLDEtMjAtMjBWNjQuNzFhMjAsMjAsMCwwLDEsMjAtMjBIMTA3Ii8+DQogIDxwYXRoIGZpbGw9Im5vbmUiIGZpbGwtb3BhY2l0eT0iMCIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjEyIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBkPSJNMTA1LjEzLDkuMzdoNDYuNzRWMTYwLjk5SDEwNS4xM1Y5LjM3WiIvPg0KICA8cGF0aCBmaWxsPSJub25lIiBmaWxsLW9wYWNpdHk9IjAiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIxMiIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgZD0iTTEyOS4wNywxNjAuOTlWOS4zNyIvPg0KICA8cGF0aCBmaWxsPSJub25lIiBmaWxsLW9wYWNpdHk9IjAiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIxMiIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgZD0iTTEyNy4zNjksMjA0LjMxaDIuMjc5bDIyLjIyMi00My4zMkgxMDUuMTQ3WiIvPg0KPC9zdmc+DQo=")
	}
	.icon_show {
		background-image: url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCAyNTYgMjU2Ij4NCiAgPHBhdGggZmlsbD0ibm9uZSIgZmlsbC1vcGFjaXR5PSIwIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMTIiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGQ9Ik0yNDYsNDBIMTAiLz4NCiAgPHBhdGggZmlsbD0ibm9uZSIgZmlsbC1vcGFjaXR5PSIwIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMTIiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGQ9Ik0yNDYsMTMwSDEwIi8+DQogIDxwYXRoIGZpbGw9Im5vbmUiIGZpbGwtb3BhY2l0eT0iMCIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjEyIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBkPSJNMjQ2LDIyMEgxMCIvPg0KPC9zdmc+")
	}
	.icon_setup {
		background-image: url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCAxMjggMTI4Ij4NCiAgPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjYiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgZD0iTTI4LjQ2OSw2LjgxM2ExNC4wNDcsMTQuMDQ3LDAsMSwxLTE0LDE0LjA0N0ExNC4wMjQsMTQuMDI0LDAsMCwxLDI4LjQ2OSw2LjgxM1ptNzQuMjY1LDQzLjIxOUExNC4wMzEsMTQuMDMxLDAsMSwxLDg4Ljc1LDY0LjA2MywxNC4wMDgsMTQuMDA4LDAsMCwxLDEwMi43MzQsNTAuMDMxWk02My45NjksOTMuMjE5YTE0LjAzMSwxNC4wMzEsMCwxLDEtMTQsMTQuMDMxQTE0LjAxNiwxNC4wMTYsMCwwLDEsNjMuOTY5LDkzLjIxOVpNNDkuOTg1LDEwNy4yNjVIMi42MjRtMC04Ni40aDExLjg0bS0xMS44NCw0My4ySDg3LjY1OW0zNy42NzQsNDMuMkg3Ny45NzFNNDIuNDUsMjAuODY1aDgyLjg4M20tOC42MTEsNDMuMmg4LjYxMSIvPg0KPC9zdmc+DQo=")
	}
    .icon_about {
        background-image: url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCAyNTYgMjU2Ij4KICA8cGF0aCBmaWxsPSJub25lIiBmaWxsLW9wYWNpdHk9IjAiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIxMiIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgZD0iTTEwNiwxMDRoMjJ2ODYiLz4KICA8Y2lyY2xlIGZpbGw9Im5vbmUiIGZpbGwtb3BhY2l0eT0iMCIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjEyIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBjeD0iMTI4IiBjeT0iNjQiIHI9IjYiLz4KICA8cGF0aCBmaWxsPSJub25lIiBmaWxsLW9wYWNpdHk9IjAiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIxMiIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgZD0iTTEwNiwxOTJoNDIiLz4KICA8Y2lyY2xlIGZpbGw9Im5vbmUiIGZpbGwtb3BhY2l0eT0iMCIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjEyIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBjeD0iMTI4IiBjeT0iMTI4IiByPSIxMjAiLz4KPC9zdmc+Cg==")
    }
    .icon_close {
        background-image: url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCAyNTYgMjU2Ij4NCiAgPGNpcmNsZSBmaWxsPSJub25lIiBmaWxsLW9wYWNpdHk9IjAiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIxMiIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgY3g9IjEyOCIgY3k9IjEyOCIgcj0iMTIwIi8+DQogIDxwYXRoIGZpbGw9Im5vbmUiIGZpbGwtb3BhY2l0eT0iMCIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjEyIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBkPSJNNzEuMDc4LDE4NC40MjJMMTg0LjkyMiw3MC41NzgiLz4NCiAgPHBhdGggZmlsbD0ibm9uZSIgZmlsbC1vcGFjaXR5PSIwIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMTIiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGQ9Ik0xODQuOTIyLDE4NC40MjJMNzEuMDc4LDcwLjU3OCIvPg0KPC9zdmc+")
    }
    .icon_ok {
        background-image: url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCAyNTYgMjU2Ij4NCiAgPGNpcmNsZSBmaWxsPSJub25lIiBmaWxsLW9wYWNpdHk9IjAiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIxMiIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgY3g9IjEyOCIgY3k9IjEyOCIgcj0iMTIwIi8+DQogIDxwYXRoIGZpbGw9Im5vbmUiIGZpbGwtb3BhY2l0eT0iMCIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjEyIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBkPSJNMTk0LDgybC04Niw4Nkw2MSwxMjQiLz4NCjwvc3ZnPg==")
    }
    .icon_build {
        background-image: url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCAyNTYgMjU2Ij4KICAgIDxwYXRoIGZpbGw9Im5vbmUiIGZpbGwtb3BhY2l0eT0iMCIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjEyIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBkPSJNMTcyLDExbDgwLDgwLTM0LDM0TDEwNC41NSwxMUgxNzJaIi8+CiAgICA8cGF0aCBmaWxsPSJub25lIiBmaWxsLW9wYWNpdHk9IjAiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIxMiIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgZD0iTTE1OCw2NWwyNSwyNUwyOSwyNDQsNCwyMTlaIi8+CiAgICA8cGF0aCBmaWxsPSJub25lIiBmaWxsLW9wYWNpdHk9IjAiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIxMiIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgZD0iTTEyMSwxMDJMOTYsMTI3LDUsMzYsMzAsMTFaIi8+CiAgICA8cGF0aCBmaWxsPSJub25lIiBmaWxsLW9wYWNpdHk9IjAiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIxMiIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgZD0iTTE0NiwxMjdsNjEsNjEtMjUsMjUtNjEtNjEiLz4KICAgIDxwYXRoIGZpbGw9Im5vbmUiIGZpbGwtb3BhY2l0eT0iMCIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjEyIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBkPSJNMjA3LDE4OGwyOSw1MS0zLDMtNTEtMjkiLz4KPC9zdmc+Cg==")
    }
    .icon_go {
        background-image: url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCAyNTYgMjU2Ij4KPHBhdGggZmlsbD0ibm9uZSIgZmlsbC1vcGFjaXR5PSIwIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMTIiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGQ9Ik04Mi4wMzEsMzYuMDYxbDkxLjkyNCw5MS45MjNMODIuMDMxLDIxOS45MDgiLz4KPC9zdmc+Cg==")
    }
    .icon_add {
        background-image: url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCAyNTYgMjU2Ij4NCiAgPGNpcmNsZSBmaWxsPSJub25lIiBmaWxsLW9wYWNpdHk9IjAiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIxMiIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgY3g9IjEyOCIgY3k9IjEyOCIgcj0iMTIwIi8+DQogIDxwYXRoIGZpbGw9Im5vbmUiIGZpbGwtb3BhY2l0eT0iMCIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjEyIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBkPSJNNDcsMTI4aDE2MSIvPg0KICA8cGF0aCBmaWxsPSJub25lIiBmaWxsLW9wYWNpdHk9IjAiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIxMiIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgZD0iTTEyOCwyMDhWNDciLz4NCjwvc3ZnPg==")
    }
    .icon_del {
        background-image: url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCAyNTYgMjU2Ij4NCiAgPHBhdGggZmlsbD0ibm9uZSIgZmlsbC1vcGFjaXR5PSIwIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMTIiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGQ9Ik0xOTQuNDMxLDYyLjY3NVYyMzAuNTA4SDYzLjU2OVY2Mi42NzUiLz4NCiAgPHBhdGggZmlsbD0ibm9uZSIgZmlsbC1vcGFjaXR5PSIwIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMTIiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGQ9Ik00Ny4zNDYsNDUuNDkySDIxMC42NTQiLz4NCiAgPHBhdGggZmlsbD0ibm9uZSIgZmlsbC1vcGFjaXR5PSIwIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMTIiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGQ9Ik0xMDgsMjNoMzlWNDVIMTA4VjIzWiIvPg0KICA8cGF0aCBmaWxsPSJub25lIiBmaWxsLW9wYWNpdHk9IjAiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIxMiIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgZD0iTTEyOC41NTUsNjIuMzgyVjIxMy40MzEiLz4NCiAgPHBhdGggZmlsbD0ibm9uZSIgZmlsbC1vcGFjaXR5PSIwIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMTIiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGQ9Ik05Mi41LDYyLjM4MlYyMTMuNDMxIi8+DQogIDxwYXRoIGZpbGw9Im5vbmUiIGZpbGwtb3BhY2l0eT0iMCIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjEyIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBkPSJNMTY0LjYwNSw2Mi4zODJWMjEzLjQzMSIvPg0KPC9zdmc+")
    }	
	.scene {
		background-color: #efefff;
		border-radius: 12px;
		padding: 4px;
		margin: 4px;
	}
	.dialog {
		padding: 4px 8px;
		margin-top: 8px;
		border-radius: 8px;
		background-color: #fff;
		font-size: 12px;
	}
	.scene_bg {
		padding: 4px 8px;
		border-radius: 8px;
		background-color: #fff;
		background-size: cover;
		background-repeat: no-repeat;
		background-position: center;
		width: calc(100% - 16px); 
		height:128px;
	}
	.choice {
		padding: 4px;
		margin-top: 8px;
		border-radius: 8px;
		background-color: #cec8e3;
		font-size: 14px;
	}
	.choice_b {
		background-color: #efefff;
		margin-bottom: 8px;
		margin-top: 8px;
		text-align: center;
		padding: 4px;
		border-radius: 6px;
		font-size: 14px;
	}
	#window_zone {
		height: 100vh; 
		width:100%;
		position: fixed;
		left: 0;
		top: 0;
		visibility:hidden;
		transition-duration: 0.5s;
        z-index: 10000;
	}
	.window {
		position: absolute;
		top: 50%;
		transform: translateX(-50%) translateY(-50%);
		left: 50%;
		background-color:#fff;
		border-radius: 16px;
		box-shadow: 0px 2px 24px rgba(110,95,165,0.25);
	}
	.button{
		border-radius: 8px;
		width: 100%;
		height: 90%;
		background-color:#efefff;
	}
	.button:hover {
		background-color:#cec8e3;
	}
	.big_button {
		border-radius: 20px;
		height: 40px;
		background-color:#efefff;
	}
	.big_button:hover {
		background-color:#cec8e3;
	}
    #search_block {
      height: 40px;
      border-left: 1px solid #cec8e3;
      border-right: 1px solid #cec8e3;
      font-size: 14px;
      width:128px;
      padding-left: 8px;
      -webkit-touch-callout: auto;
      -webkit-user-select: auto;
      -khtml-user-select: auto;
      -moz-user-select: auto;
      -ms-user-select: auto;
      user-select: auto;
    }
	.input_text {
		border:0;
		font-family:inherit;
		-webkit-appearance: none;
		border-bottom:1px solid #cec8e3;
		border-radius:0;
		padding-left:8px;
        font-size:14px;
		cursor: text;
		height:28px; 
		width:100%;
		-webkit-touch-callout: auto;
		-webkit-user-select: auto;
		-khtml-user-select: auto;
		-moz-user-select: auto;
		-ms-user-select: auto;
		user-select: auto;
	}
	.input_text:focus {
		border-bottom: 1px solid #000;
	}
	hr {border-top: 1px solid #cec8e3; margin:4px;}
	.checkbox_a {
		content:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCAyNTYgMjU2Ij4NCiAgPGNpcmNsZSBmaWxsPSJub25lIiBmaWxsLW9wYWNpdHk9IjAiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIxOCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgY3g9IjEyOCIgY3k9IjEyOCIgcj0iMTEyIi8+DQo8L3N2Zz4=");
		background: none;
		-webkit-appearance: none;
		-moz-appearance: none;
		appearance: none;
		height: 16px;
		width: 16px;
	 }
	.checkbox_a:checked  {
		content: url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCAyNTYgMjU2Ij4NCiAgPGNpcmNsZSBmaWxsPSJub25lIiBmaWxsLW9wYWNpdHk9IjAiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIxOCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgY3g9IjEyOCIgY3k9IjEyOCIgcj0iMTEyIi8+DQogIDxwYXRoIGZpbGw9Im5vbmUiIGZpbGwtb3BhY2l0eT0iMCIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjE4IiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBkPSJNMTk0LDgybC04Niw4Nkw2MSwxMjQiLz4NCjwvc3ZnPg==");
		background: none;
	 }
	 .set_button {
		font-size: 14px;
		height: 40px;
		border-right:1px solid #cec8e3;
		padding:0px 8px;
		background-color: #efefff;
	 }
	 .set_select {
		background-color: #cec8e3;
	 }
	 .set_blank {overflow-x: hidden; position: absolute; overflow-y: auto; width:100%; height:60vh;}
	 .window_close {position:absolute; right: 0px; top: 0px; absolute; height: 40px; width: 40px; cursor:pointer;}
    </style>
</head>
<body onload="world_size(); lines(); control_dlock();" style='background-color: #efefff;'>
	<div id="menu_panel">
		<table  width="100%" height="100%">
			<tbody>
				<tr>
					<td align='center' style='cursor:pointer;' title='New project' onclick='new_novel();' class='icon button_menu icon_new'></td>
                    <td align='center' style='cursor:pointer;' title='Load project folder ' onclick='json_file.click()' class='icon button_menu icon_load'></td>
					<td align='center' style='cursor:pointer;' title='Save JSON script project' onclick='save_file()' class='icon button_menu icon_save'></td>
					<td align='center' style='cursor:pointer;' title='Settings project' onclick='setup()' class='icon button_menu icon_setup'></td>
                    <td align='center' style='cursor:pointer;' title='Edit json text' onclick='jsonedit()' class='icon button_menu icon_edit'></td>
                    <td align='center' style='cursor:pointer;' title='About visual editor' onclick='about()' class='icon button_menu icon_about'></td>
                    <td align='center' style='width:128px;'><input type="text" id="search_block" onkeyup="search_block()" placeholder="search block"></td>
					<td align='center' style='cursor:pointer;' title='Build project' onclick='build()' class='icon button_menu icon_build'></td>
					<td align='center' style='border-radius: 0 0 16px 0; cursor:pointer;' title='Run preview Project' onclick='play_novel()' class='icon button_menu icon_play'></td>
				</tr>
			</tbody>
		</table>
	</div>
	<input type="file" id="json_file" style="display: none; position: fixed;" multiple webkitdirectory/>
	<a id="downloadAnchorElem" style="display:none; position: fixed;"></a>
	<svg id="story_lines" xmlns="http://www.w3.org/2000/svg" width="512" height="512" viewBox="0 0 512 512"></svg>
	<div id="story_blocks"></div>
	<div id='window_zone' align='center'></div>
<script>
var body = document.body,
html = document.documentElement;
var all_blocks = document.getElementsByClassName("story_block");
var story_lines = document.getElementById("story_lines");
let story_script = {};
let line_controll = [];
var img_file = document.getElementById('json_file');
let plugins_list = {
	"toast": {
		"name":"toast",
		"text":"small message appears for a while",
		"file":"plugins/toast.js"
	},"touch_swipe": {
		"name":"touch swipe",
		"text":"switches dialogue by swiping your finger across the touchscreen",
		"file":"plugins/touch_swipe.js"
	}
}
var languare = "en";
let languares = {"English":"en","Japanese":"ja","Korean":"ko","Spanish":"es","Russian":"ru","French":"fr","Dutch":"nl","Abkhazian":"ab","Afar":"aa","Afrikaans":"af","Akan":"ak","Albanian":"sq","Amharic":"am","Arabic":"ar","Aragonese":"an","Armenian":"hy","Assamese":"as","Avaric":"av","Avestan":"ae","Aymara":"ay","Azerbaijani":"az","Bambara":"bm","Bashkir":"ba","Basque":"eu","Belarusian":"be","Bengali (Bangla)":"bn","Bihari":"bh","Bislama":"bi","Bosnian":"bs","Breton":"br","Bulgarian":"bg","Burmese":"my","Catalan":"ca","Chamorro":"ch","Chechen":"ce","Chichewa, Chewa, Nyanja":"ny","Chinese":"zh","Chinese (Simplified)":"zh-Hans","Chinese (Traditional)":"zh-Hant","Chuvash":"cv","Cornish":"kw","Corsican":"co","Cree":"cr","Croatian":"hr","Czech":"cs","Danish":"da","Divehi, Dhivehi, Maldivian":"dv","Dzongkha":"dz","Esperanto":"eo","Estonian":"et","Ewe":"ee","Faroese":"fo","Fijian":"fj","Finnish":"fi","Fula, Fulah, Pulaar, Pular":"ff","Galician":"gl","Gaelic (Scottish)":"gd","Gaelic (Manx)":"gv","Georgian":"ka","German":"de","Greek":"el","Greenlandic":"kl","Guarani":"gn","Gujarati":"gu","Haitian Creole":"ht","Hausa":"ha","Hebrew":"he","Herero":"hz","Hindi":"hi","Hiri Motu":"ho","Hungarian":"hu","Icelandic":"is","Ido":"io","Igbo":"ig","Indonesian":"id","Interlingua":"ia","Interlingue":"ie","Inuktitut":"iu","Inupiak":"ik","Irish":"ga","Italian":"it","Javanese":"jv","Kalaallisut, Greenlandic":"kl","Kannada":"kn","Kanuri":"kr","Kashmiri":"ks","Kazakh":"kk","Khmer":"km","Kikuyu":"ki","Kinyarwanda (Rwanda)":"rw","Kirundi":"rn","Kyrgyz":"ky","Komi":"kv","Kongo":"kg","Kurdish":"ku","Kwanyama":"kj","Lao":"lo","Latin":"la","Latvian (Lettish)":"lv","Limburgish ( Limburger)":"li","Lingala":"ln","Lithuanian":"lt","Luga-Katanga":"lu","Luganda, Ganda":"lg","Luxembourgish":"lb","Manx":"gv","Macedonian":"mk","Malagasy":"mg","Malay":"ms","Malayalam":"ml","Maltese":"mt","Maori":"mi","Marathi":"mr","Marshallese":"mh","Moldavian":"mo","Mongolian":"mn","Nauru":"na","Navajo":"nv","Ndonga":"ng","Northern Ndebele":"nd","Nepali":"ne","Norwegian":"no","Norwegian bokmål":"nb","Norwegian nynorsk":"nn","Nuosu":"ii","Occitan":"oc","Ojibwe":"oj","Old Church Slavonic, Old Bulgarian":"cu","Oriya":"or","Oromo (Afaan Oromo)":"om","Ossetian":"os","Pāli":"pi","Pashto, Pushto":"ps","Persian (Farsi)":"fa","Polish":"pl","Portuguese":"pt","Punjabi (Eastern)":"pa","Quechua":"qu","Romansh":"rm","Romanian":"ro","Sami":"se","Samoan":"sm","Sango":"sg","Sanskrit":"sa","Serbian":"sr","Serbo-Croatian":"sh","Sesotho":"st","Setswana":"tn","Shona":"sn","Sichuan Yi":"ii","Sindhi":"sd","Sinhalese":"si","Siswati":"ss","Slovak":"sk","Slovenian":"sl","Somali":"so","Southern Ndebele":"nr","Sundanese":"su","Swahili (Kiswahili)":"sw","Swati":"ss","Swedish":"sv","Tagalog":"tl","Tahitian":"ty","Tajik":"tg","Tamil":"ta","Tatar":"tt","Telugu":"te","Thai":"th","Tibetan":"bo","Tigrinya":"ti","Tonga":"to","Tsonga":"ts","Turkish":"tr","Turkmen":"tk","Twi":"tw","Uyghur":"ug","Urdu":"ur","Uzbek":"uz","Venda":"ve","Vietnamese":"vi","Volapük":"vo","Wallon":"wa","Welsh":"cy","Wolof":"wo","Western Frisian":"fy","Xhosa":"xh","Yiddish":"yi","Yoruba":"yo","Zhuang, Chuang":"za","Zulu":"zu"}
let project_files = [];
img_file.addEventListener('change', loadFiles);
new_novel ()
function loadFiles(e) {
	var wf = e.target.files[0].webkitRelativePath.split("/")[0] + "/";
	var jsons = [];
	for (var i=0; i < e.target.files.length; i++) {
		project_files.push( [e.target.files[i].webkitRelativePath.replace(wf,'').replace('.mp3','') , URL.createObjectURL(e.target.files[i])] );			
		if (e.target.files[i].type == "application/json"){
			jsons.push([i,e.target.files[i].name])
		}
	}	
	if (jsons.length == 1) {
		load_story_edit(URL.createObjectURL(e.target.files[jsons[0][0]]))
	} else if (jsons.length > 1) {
		var html = "<div class='window'><div style'position:relative;'><div class='window_close icon icon_close' onclick='modal_window(\"close\")'></div></div><br><p>Select JSON project file</p><br><hr><div style='margin: 0 16px 8px 16px; max-height: 75vh; overflow-x: hidden;'>"
		for (var f=0; f < jsons.length; f++) {
			html += "<table class='button' style='margin: 8px 0px;' onclick='load_story_edit(open_file(\"" + jsons[f][1] + "\")); modal_window(\"close\"); '><tbody><tr><td align='center' width='48px' height='48px' class='icon icon_new'> </td><td align='left' style=''>" + jsons[f][1] + "</td><td align='center' width='48px'></td></tr></tbody></table>"
		} 
		html += "</div></div>"
		modal_window("open", html)
    } else if (jsons.length == 0) {alert('json file no found')}
}
function open_file (name) {
	for (var f=0; f < project_files.length; f++) {
		if (project_files[f][0] == name){
			return (project_files[f][1])
		}
	}
}
function new_novel () {
	story_blocks.innerHTML = ""
	story_script = {"parameters":{"plugins":[],"title":"","launch_story":"","key":{}}};
	line_controll = [];
    document.getElementById("search_block").value = ""
	while (story_lines.hasChildNodes()) {
		story_lines.removeChild(story_lines.firstChild);
	}
}
function load_story_edit(url) {
	var xmlhttp = new XMLHttpRequest();
	xmlhttp.onreadystatechange = function() {
		if (this.readyState == 4 && this.status == 200) {
			new_novel ()
			story_script = JSON.parse(this.responseText);
			if(!story_script.parameters){alert ("error in json file")}
			else {
				parse_story()
				lines()
			}
		}
	};
	xmlhttp.open("GET", url, true);
	xmlhttp.send();
	xmlhttp.onerror = function() {
		if (this.status == 0) {alert( 'json file not loaded' );}
	}
}
var all_blocks = 0;
function parse_story() {
	story_blocks = document.getElementById("story_blocks");
	story_blocks.innerHTML = ""
	story_lines = document.getElementById("story_lines");
	while (story_lines.hasChildNodes()) {
		story_lines.removeChild(story_lines.firstChild);
	}
	all_blocks = 0;
	while (Object.keys(story_script)[all_blocks]) {
        creation_block(all_blocks);
		all_blocks++;
	}
    control_dlock()
}
function creation_block(b) {
    var chapter = document.createElement("div");
	var element = "";
    var all = 0;
    chapter.id = Object.keys(story_script)[b];
	var go = "";
	if ( chapter.id != "parameters") {
		for (var i=0; i < story_script[chapter.id].length; i++){
			element += "<div class='scene'>" 
			if (story_script[chapter.id][i].legacy_choice){
				element += "<div width='100%'>"
				for (var l=0; l < story_script[chapter.id][i].legacy_choice.length; l++){
					if (story_script[chapter.id][i].legacy_choice[l][0]) {
						go =  story_script[chapter.id][i].legacy_choice[l][3];
						if (story_script[go]) {
							element += "<table id='"+all+"l"+l+go+all_blocks+"' class='choice to_go' width='100%'><tbody><tr><td style=padding:4px;>" + story_script[chapter.id][i].legacy_choice[l][0] + " " + story_script[chapter.id][i].legacy_choice[l][1] + " " + story_script[chapter.id][i].legacy_choice[l][2] + "</td><td align='center'>" + go + "</td><td class='icon button_block icon_go' style='cursor:pointer;' onmouseup=\"go_to_block('"+go+"')\"> </td></tr></tbody></table>"
							line_controll.push( [go, chapter.id, all+"l"+l+go+all_blocks] );
							creaton_line (all+"l"+l+go+all_blocks)
							all++
						} else {
							element += "<table id='"+all+"l"+l+go+all_blocks+"' class='choice' width='100%'><tbody><tr><td>" + story_script[chapter.id][i].legacy_choice[l][0] + " " + story_script[chapter.id][i].legacy_choice[l][1] + " " + story_script[chapter.id][i].legacy_choice[l][2] + "</td><td align='center'>" + go + "</td><td class='icon button_block icon_go' style='cursor:pointer;' onmouseup=\"go_to_block('"+go+"')\"> </td></tr></tbody></table>"
						}
					} else if (story_script[chapter.id][i].legacy_choice[l].go_to) {
						go =  story_script[chapter.id][i].legacy_choice[l].go_to;
						if (story_script[go]) {						
							element += "<table id='"+all+"l"+l+go+all_blocks+"' class='choice to_go' style='width:100%;'><tbody><tr><td style='padding:4px;'>"+go+"</td><td class='button_block icon icon_go' style='cursor:pointer;' onmouseup=\"go_to_block('"+go+"')\"> </td></tr></tbody></table>"
							line_controll.push( [go, chapter.id, all+"l"+l+go+all_blocks] );
							creaton_line (all+"l"+l+go+all_blocks)
							all++
						} else {element += "<div id='"+all+"l"+l+go+all_blocks+"' class='choice'>"+go+"</div>"}
					}
				}
				element += "</div>"
			}
			if (story_script[chapter.id][i].background_image){element += "<div class='scene_bg' style=' background-image: url(" + open_file (languare_data (story_script[chapter.id][i].background_image)) + ")' width='100%'></div>"}
			if (story_script[chapter.id][i].dialogs) {
				for (var d=0; d < story_script[chapter.id][i].dialogs.length; d++){
					var n = languare_data (story_script[chapter.id][i].dialogs[d].name);
					if (story_script[chapter.id][i].dialogs[d].text) {element += "<div class='dialog'>" + ((n)? "<p><b>" + n + "</p></b><br>" : "" ) + "<p>" + languare_data (story_script[chapter.id][i].dialogs[d].text) + "</p></div>"}
					if (story_script[chapter.id][i].dialogs[d].go_to) {
						go = story_script[chapter.id][i].dialogs[d].go_to;
						if (story_script[go]) {
							element += "<table id='"+all+"g"+d+go+all_blocks+"' class='choice to_go' style='width:100%;'><tbody><tr><td style='padding: 4px;'>"+go+"</td><td class='button_block icon icon_go' style='cursor:pointer;' onmouseup=\"go_to_block('"+go+"')\"> </td></tr></tbody></table>"
							line_controll.push( [go, chapter.id, all+"g"+d+go+all_blocks] );
							creaton_line (all+"g"+d+go+all_blocks)
							all++
						} else {element += "<div id='"+all+"g"+d+go+all_blocks+"' class='choice'>"+go+"</div>";}
					}
					if (story_script[chapter.id][i].dialogs[d].choice) {
						element += "<div id='' class='choice'>"
						for (var c=0; c < story_script[chapter.id][i].dialogs[d].choice.length; c++){
							go = story_script[chapter.id][i].dialogs[d].choice[c].go_to;
							if (go && go != "load" && go != "load_autosave" && go != "" && go != "undefined") {
								var t = languare_data(story_script[chapter.id][i].dialogs[d].choice[c].text)
								if (story_script[go]) {
									element += "<table id='"+all+"c"+d+go+all_blocks+"' style='width:100%;' class='choice_b to_go'><tbody><tr><td class='button_block'></td><td>" + ((t == "")? go : t ) + "</td><td class='button_block icon icon_go' style='cursor:pointer;' onmouseup=\"go_to_block('"+go+"')\"> </td></tr></tbody></table>"
									line_controll.push( [go, chapter.id, all+"c"+d+go+all_blocks] );
									creaton_line (all+"c"+d+go+all_blocks)
									all++
								} else {element += "<div id='"+all+"c"+d+go+all_blocks+"' class='choice_b'>" + ((t == "")? go : t ) + "</div>"}
							} else {
								var t = languare_data(story_script[chapter.id][i].dialogs[d].choice[c].text)
								element += "<div class='choice_b'>" + ((t == "")? go : t ) + "</div>"
							}
						}
						element += "</div>"
					}
				}
			}
			element += "</div>"
		}
		chapter.innerHTML = "<div style='margin:8px;'><table height='100%' width='100%'><tbody><tr><td align='center' style='cursor:pointer;'  onmousedown=\"block_open('"+chapter.id+"_content')\" class='button_block icon_show'></td><td align='center'>"+chapter.id+"</td><td align='center' style='cursor:pointer;' onmouseup=\"play_novel('"+chapter.id+"')\" class='icon button_block icon_play'></td></tr></tbody></table></div><div id='"+chapter.id+"_content' style='display: none;'>" + element + "</div>";
		chapter.className = "story_block panel";
		chapter.style.left = 64 + (320 * (all_blocks-1)) + "px";
		chapter.style.top = 64 + (128 * (all_blocks-1)) + "px";
		story_blocks.appendChild(chapter);
	}
}
function languare_data (data) {
	if (data) {return  ((data[languare]) ? data[languare] : data) ;} 
	else {return ""}
}
function creaton_line (id) {
    var newLine = document.createElementNS("http://www.w3.org/2000/svg", 'line');
    newLine.id = id + "l"
    story_lines.appendChild(newLine);
}
function save_file() {
    var d = new Date();
	var n = "new";
	var dm = String(d.getMonth());
	var dd = String(d.getDay());
	var dh = String(d.getHours());
	var dm = String(d.getMinutes());
	var ds = String(d.getSeconds());
    var dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(story_script));
    var dlAnchorElem = document.getElementById('downloadAnchorElem');
	if (story_script.parameters.title){n = (story_script.parameters.title.en)? story_script.parameters.title.en: story_script.parameters.title;}
	else {n = "new_novel";}
    dlAnchorElem.setAttribute("href", dataStr );
    dlAnchorElem.setAttribute("download", n + '_' + d.getFullYear() + '_' + (dm.length <2 ? '0'+ dm : dm) + '_' + (dd.length <2 ? '0'+ dd : dd) +'_'+ (dh.length <2 ? '0'+ dh : dh) + (dm.length <2 ? '0'+ dm : dm) + (ds.length <2 ? '0'+ ds : ds) +'.json');
    dlAnchorElem.click();
}
function lines(elem) {
	var to_go = document.getElementsByClassName("to_go");
	for (var x = 0 ; x < to_go.length; x++){
		if (elem == line_controll[x][1] || elem == line_controll[x][0]) {document.getElementById( line_controll[x][2]+"l" ).style.visibility = 'visible'} 
		else {document.getElementById( line_controll[x][2]+"l" ).style.visibility = 'hidden'}
		var title_block;
		if (document.getElementById( line_controll[x][1] + "_content" ).style.display == 'none'){
			title_block = document.getElementById(line_controll[x][0]).getBoundingClientRect();
			var rect = document.getElementById(line_controll[x][1]).getBoundingClientRect();
			var l1 = html.scrollLeft + rect.left;
			var l2 = html.scrollLeft + title_block.left
			if (l1 > l2){
				moveSlider(rect.left + html.scrollLeft, 'x2', line_controll[x][2]);
				moveSlider(rect.top + html.scrollTop + 22, 'y2', line_controll[x][2]);
				moveSlider(l2 + 256, 'x1', line_controll[x][2]);
				moveSlider(title_block.top + html.scrollTop + 22, 'y1', line_controll[x][2]);
			} else {
				moveSlider(rect.left + html.scrollLeft + 256, 'x2', line_controll[x][2]);
				moveSlider(rect.top + html.scrollTop + 22, 'y2', line_controll[x][2]);
				moveSlider(l2, 'x1', line_controll[x][2]);
				moveSlider(title_block.top + html.scrollTop + 22, 'y1', line_controll[x][2]);
			}
		} else {
			title_block = document.getElementById(line_controll[x][0]).getBoundingClientRect();
			var rect = document.getElementById(line_controll[x][2]).getBoundingClientRect();
			var l1 = html.scrollLeft + rect.left;
			var l2 = html.scrollLeft + title_block.left
			if (l1 > l2){
				moveSlider(rect.left + html.scrollLeft - 12, 'x2', line_controll[x][2]);
				moveSlider(rect.top + html.scrollTop + 12, 'y2', line_controll[x][2]);
				moveSlider(l2 + 256, 'x1', line_controll[x][2]);
				moveSlider(title_block.top + html.scrollTop + 22, 'y1', line_controll[x][2]);
			} else {
				moveSlider(rect.left + html.scrollLeft + 244, 'x2', line_controll[x][2]);
				moveSlider(rect.top + html.scrollTop + 12, 'y2', line_controll[x][2]);
				moveSlider(l2, 'x1', line_controll[x][2]);
				moveSlider(title_block.top + html.scrollTop + 22, 'y1', line_controll[x][2]);
			}
		}
	}
}
var moveSlider = function(slider, direction, id) {
	var value = slider;
	var element = document.getElementById(id + "l");
	var coord = direction;
	element.setAttributeNS(null, coord, value);
}
function control_dlock () {
    all_blocks = document.getElementsByClassName("story_block");
    for (var i=0; i < all_blocks.length; i++){
        movie_dlock(all_blocks[i].id)
    }
}
var scroll_block = false;
function movie_dlock(id){
	var focus_dlock = document.getElementById(id);
	focus_dlock.onmousedown = function(e) {
		var coords = getCoords(focus_dlock);
		var shiftX = e.pageX - coords.left;
		var shiftY = e.pageY - coords.top;
		scroll_block = true;
		focus_dlock.style.position = 'absolute';
		focus_dlock.style.animation = false;
		focus_dlock.style.WebkitAnimation = false;
		story_blocks.appendChild(focus_dlock);
		moveAt(e);
		function moveAt(e) {
			focus_dlock.style.left = e.pageX - shiftX + 'px';
			focus_dlock.style.top = e.pageY - shiftY + 'px';
			lines(id)
		}
	  document.onmousemove = function(e) {
		moveAt(e);
	  };
	  focus_dlock.onmouseup = function() {
		document.onmousemove = null;
		focus_dlock.onmouseup = null;
		scroll_block = false;
		world_size()
	  };
	}
	focus_dlock.ondragstart = function() {
		return false;
	};
	function getCoords(elem) {
		var box = elem.getBoundingClientRect();
		return {
			top: box.top + pageYOffset,
			left: box.left + pageXOffset
		};
	}
}
function world_size() {
	var height = Math.max( body.scrollHeight, body.offsetHeight, html.clientHeight, html.scrollHeight, html.offsetHeight );
	var width = Math.max( body.scrollWidth, body.offsetWidth, html.clientWidth, html.scrollWidth, html.offsetWidth );
	story_lines.setAttribute("height", height);
	story_lines.setAttribute("width", width);
	story_lines.setAttribute("viewBox", "0,0,"+ width +","+ height);
}
function block_open(id) {
	var e = document.getElementById(id);
	if (e.style.display === "block") {
	  e.style.display = "none";
	} else {
	  e.style.display = "block";
	}
	lines()
}
var startmove_x = null;
var startmove_y = null;
var scroll_x = null;
var scroll_y = null;
html.ontouchstart = function(e) {
	if (!scroll_block) {
		startmove_x = e.touches[0].clientX;
		startmove_y = e.touches[0].clientY;	
		scroll_x = html.scrollTop;
		scroll_y = html.scrollLeft;
		html.ontouchmove = function(e) {
			html.scrollTop = scroll_x - (e.touches[0].clientY - startmove_y);
			html.scrollLeft = scroll_y - (e.touches[0].clientX - startmove_x);
		};
		html.ontouchend = function (e){
			startmove_x = null;
			startmove_y = null;
			html.ontouchmove = null;
			html.ontouchend = null;
		};
	}
}
html.onmousedown = function(e) {
	if (!scroll_block) {
		startmove_x = e.clientX;
		startmove_y = e.clientY;
		scroll_x = html.scrollTop;
		scroll_y = html.scrollLeft;
		html.onmousemove = function(e) {
			html.scrollTop = scroll_x - (e.clientY - startmove_y);
			html.scrollLeft = scroll_y - (e.clientX - startmove_x);
		};
		html.onmouseup = function (e){
			startmove_x = null;
			startmove_y = null;
			html.onmousemove = null;
			html.onmouseup = null;
		};
	}
}
function modal_window(action, content) {
    var window_zone = document.getElementById("window_zone");
    if (action == 'close') {
        window_zone.style.visibility = "hidden"
        window_zone.style.backgroundColor = 'rgba(110,95,165,0)';
        document.body.style.overflow = 'scroll';
        scroll_block = false;
        window_zone.innerHTML = "";
    } else if (action == 'open' && window_zone.style.visibility != "visible") {
        window_zone.style.visibility = "visible";
        window_zone.style.backgroundColor = 'rgba(110,95,165,0.5)';
        document.body.style.overflow = 'hidden';
		window_zone.innerHTML = content;
        scroll_block = true;
    }
}
function play_novel(bl) {
	var story_preview = JSON.stringify(story_script)
	for (var f=0; f < project_files.length; f++) {
		for (var r=JSON.stringify(story_script).split(project_files[f][0]).length+2; r > 0; r--) {
			story_preview = story_preview.replace(project_files[f][0],project_files[f][1])
		}
	}
	var preview = window.open("https://kirilllive.github.io/Tuesday/tuesday_visual.html", "preview", "location=no,scrollbars=no,width=640,height=480");
    preview.document.write("<html><head><style> body { font-family: " + story_script.parameters.font + "; font-size: " + story_script.parameters.font_size + "; background-color: #fff; border-collapse: collapse; border: none; margin: 0; padding: 0; border: 0; border-spacing: 0px; -webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none;}<\/style><\/head><body><div id='tuesday' style='width:100%; height:100vh;'> <\/div><script type='text/javascript' src='tuesday.js'><\/script><script>let story_preview = " + story_preview + "; " + ((bl)?"tuesday.addEventListener('script_loaded', function(event) {go_to('"+bl+"')});":"") + " load_story('data',story_preview); <\/script><\/body><\/html>");
}
function search_block() {
    var input, filter, li, i, txtValue;
    input = document.getElementById("search_block");
    filter = input.value.toUpperCase();
    li = document.getElementsByClassName("story_block");
    var ferst = false
    for (i = 0; i < li.length; i++) {
        txtValue = li[i].id.toUpperCase();
        if (txtValue.toUpperCase().indexOf(filter) > -1) {
            li[i].style.opacity = 1;
            if (filter.length > 0 && !ferst){scroll_to_block(li[i]); ferst = true;}
            else if (filter == txtValue) {scroll_to_block(li[i]); ferst = true;}
        } else {
            li[i].style.opacity = 0.25;
        }
    }
}
function go_to_block(bl) {
	bl = document.getElementById(bl);
	scroll_to_block(bl)
}
function scroll_to_block(bl) {
    var rect = bl.getBoundingClientRect();
    html.scrollTop = (html.scrollTop + (rect.top - (html.clientHeight / 2) + 22));
    html.scrollLeft = (html.scrollLeft + (rect.left - (html.clientWidth / 2) + (rect.width/2)));
	bl.style.animation = "flash 2s 1";
	bl.style.WebkitAnimation = "flash 2s 1";
    story_blocks.appendChild(bl);
}
function about() {
	var html = "<div class='window' style='padding:24px 16px; width: 412px;'><div style'position:relative;'><div class='window_close icon icon_close' onclick='modal_window(\"close\")'></div></div><div align='center'><p style='font-size: 22px;'>Tuesday js visual editor</p><hr><p style='font-size: 14px;'>Version: 0.01 (alpha)</p><br><p style='font-size: 14px;'>Sorry Ability to create and edit content in development.<br>It is possible to open an existing project</p><br><table style='font-size: 14px; border-spacing:10px; border-collapse: separate;'><tr><td align='right'>Home: </td><td align='left'><a href='https://kirilllive.github.io/Tuesday' target='_blank'>https://kirilllive.github.io/Tuesday</a></td></tr><tr><td align='right'>itch.io: </td><td align='left'><a href='https://kirill-live.itch.io/tuesday' target='_blank'>https://kirill-live.itch.io/tuesday</a></td></tr><tr><td align='right'>GitHub: </td><td align='left'><a href='https://github.com/Kirilllive/Tuesday' target='_blank'>https://github.com/Kirilllive/Tuesday</a></td></tr></table><br><p><a href='https://www.patreon.com/kirill_live' target='_blank'><svg height='40' width='198' viewBox='0 0 1000 200' xmlns='http://www.w3.org/2000/svg'><path d='M0 0h1000v200H0z' fill='#FF424D'/><path d='M310 129V72h19c7 0 12 1 15 4 4 2 5 6 5 11 0 3 0 5-2 7-1 3-3 4-6 5a13 13 0 0110 13c0 6-2 10-6 13-3 2-8 4-14 4zm10-26v18h11l7-2c2-2 3-4 3-7 0-6-3-9-9-9zm0-7h10l7-2c2-2 2-4 2-6 0-3 0-5-2-6l-8-2h-9zm58 34c-6 0-11-2-14-6-4-4-6-9-6-15v-1l2-12c2-3 4-6 7-7 3-2 6-3 10-3 6 0 10 2 13 5 4 4 5 9 5 16v4h-27c0 3 1 6 3 8s5 3 8 3c4 0 8-2 10-5l5 5-6 6zm-1-37c-3 0-5 1-6 3-2 2-3 5-3 8h18v-1c0-3-1-5-3-7-1-2-3-3-6-3zm43 29l6-2 2-5h9l-2 7-7 6-8 2c-6 0-11-2-14-6-4-4-5-9-5-16v-1c0-6 1-12 5-15 3-4 8-6 14-6 5 0 9 1 12 4s5 7 5 12h-9l-2-6-6-3c-3 0-6 2-7 4-2 2-3 5-3 10v1c0 5 1 8 3 11 1 2 4 3 7 3zm23-15c0-4 0-8 2-11s4-6 7-7c3-2 6-3 10-3 6 0 11 2 14 5 4 4 6 9 6 15v2c0 4-1 8-3 11-1 4-3 6-6 8s-7 3-11 3c-6 0-10-2-14-6s-5-10-5-16zm9 1c0 5 1 8 3 10 2 3 4 4 7 4s6-1 8-4c2-2 2-6 2-11 0-4 0-7-2-10-2-2-5-4-8-4s-5 2-7 4c-2 3-3 6-3 11zm47-21v4c3-3 7-5 12-5 6 0 10 2 12 6 3-4 7-6 13-6 5 0 8 1 10 4 3 2 4 6 4 11v28h-10v-28l-1-6-6-1-6 1-2 5v29h-10v-28c0-5-3-7-8-7-3 0-6 1-8 4v31h-9V87zm79 43c-6 0-11-2-15-6-3-4-5-9-5-15v-1l2-12c2-3 4-6 7-7 3-2 6-3 10-3 6 0 10 2 13 5 4 4 5 9 5 16v4h-28l4 8c2 2 5 3 8 3 4 0 8-2 10-5l5 5-6 6zm-1-37c-3 0-5 1-6 3-2 2-3 5-3 8h18v-1c-1-3-1-5-3-7-1-2-3-3-6-3zm71 36l-1-4c-3 3-7 5-12 5-4 0-7-2-10-4s-4-5-4-9 2-8 5-10c3-3 8-4 14-4h6v-3c0-2 0-4-2-5l-5-2-6 2-2 4h-9l2-7 6-4c3-2 6-2 9-2 5 0 9 1 12 4 3 2 5 6 5 10v19l1 9v1zm-11-7l5-1 4-4v-8h-5l-8 2c-2 1-2 3-2 5l1 4zm59-14v21h-10V72h22c7 0 12 2 15 5 4 3 6 8 6 13 0 6-2 10-6 13-3 3-8 5-15 5zm0-8h12c4 0 6-1 8-3 2-1 3-4 3-7s-1-5-3-7-4-3-7-3h-13zm66 29l-1-4c-3 3-7 5-11 5s-8-2-11-4c-2-2-4-5-4-9s2-8 5-10c4-3 9-4 15-4h6v-3l-2-5-6-2-5 2c-2 1-2 2-2 4h-10c0-3 1-5 3-7 1-2 3-3 6-4 2-2 5-2 9-2 5 0 9 1 12 4 2 2 4 6 4 10v19l2 9v1zm-10-7l5-1 4-4v-8h-6l-8 2-2 5c0 2 0 3 2 4 1 1 2 2 5 2zm40-46v11h7v7h-7v23l1 4 3 1 4-1v8l-7 1c-7 0-11-4-11-12V94h-7v-7h7V76zm37 19h-4c-5 0-7 2-9 5v29h-9V87h9v4c2-3 5-5 9-5h4zm4 12l2-11c2-3 4-6 7-7 3-2 7-3 11-3 5 0 10 2 13 5 4 4 6 9 6 15v2l-2 11c-2 4-4 6-7 8s-6 3-10 3c-6 0-11-2-15-6-3-4-5-10-5-16zm9 1c0 5 1 8 3 10 2 3 4 4 8 4 3 0 5-1 7-4 2-2 3-6 3-11 0-4-1-7-3-10-2-2-4-4-7-4-4 0-6 2-8 4-2 3-3 6-3 11zm47-21v4c3-3 8-5 13-5 8 0 13 5 13 15v28h-9v-28l-2-5c-1-2-3-2-6-2-4 0-7 1-8 5v30h-10V87z' fill='#fff'/><path d='M165 39c-25 0-45 21-45 46s20 46 45 46 45-21 45-46-20-46-45-46' fill='#fff'/><path d='M83 161V39h23v122z' fill='#fff'/></svg></a></p></div></div>"
	modal_window("open", html)
}
function build() {
	var font_family = story_script.parameters.font
	var font_size = story_script.parameters.font_size
	var plugins_code = "";
	for(var i=0;i < story_script.parameters.plugins.length; i++) {
		plugins_code += "<script type='text/javascript' src='"+plugins_list[story_script.parameters.plugins[i]].file+"'><\/script>"
	}
	delete story_script.parameters['plugins'];
	delete story_script.parameters['font'];
	delete story_script.parameters['font_size'];
	var story_preview = JSON.stringify(story_script)
	var dataStr = "data:text/json;charset=utf-8," + encodeURIComponent("<html><head><style> body {font-family: "+font_family+"; font-size: "+font_size+"; background-color: #fff; border-collapse: collapse; border: none; margin: 0; padding: 0; border: 0; border-spacing: 0px; -webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none;}<\/style><\/head><body><div id='tuesday' style='width:100%; height:100vh;'> <\/div><script type='text/javascript' src='tuesday.js'><\/script>"+plugins_code+"<script>let story_novel = " + story_preview + "; load_story('data',story_novel); <\/script><\/body><\/html>");
	var dlAnchorElem = document.getElementById('downloadAnchorElem');
	dlAnchorElem.setAttribute("href", dataStr );
    dlAnchorElem.setAttribute('download', 'index.html');
    dlAnchorElem.click();
}
function jsonedit() {
    var story_preview = JSON.stringify(story_script, null, '\t')
    var html = "<div class='window' style='padding:24px 16px; width: 75vw;'><div style'position:relative;'><div class='window_close icon icon_close' onclick='modal_window(\"close\")' ></div></div><p>JSON Edit</p><br><p><textarea id='editJson' class='input_text' wrap='off' style='resize: none; padding-left:0px; height:calc(90vh - 128px); width:100%; border:1px solid #cec8e3;'>" + story_preview + "</textarea></p><br><table class='big_button' width='256px' onclick='apply_json( document.getElementById(\"editJson\").value)'><tbody><tr><td width='42px' class='icon icon_ok'></td><td align='center'>Apply</td><td width='42px'></td></tr></tbody></table></div>"
    modal_window("open", html)
}
function apply_json(data) {
    new_novel ()
    story_script = JSON.parse(data);
    parse_story()
    lines()
    modal_window('close')
}
function setup() {
	var block_list;
	var i
	var li = document.getElementsByClassName("story_block");
	if (!story_script.parameters.plugins){story_script.parameters.plugins = []}
	for (i = 0; i < li.length; i++) {
		block_list += "<option value='"+li[i].id+"' "+((li[i].id == story_script.parameters.launch_story)?"selected":"")+">"+li[i].id+"</option>"     
    }
	var var_list = "<table width='100%' id='var_tablet'><tbody>";
	if (story_script.parameters.variables){
		for (i = 0; i < Object.keys(story_script.parameters.variables).length; i++) {
			var_list += "<tr><td style='padding-right:8px; border-right:1px solid #cec8e3; width:40%; padding-top: 10px;'><input class='var_name input_text' placeholder='Name' value='" 
				+ Object.keys(story_script.parameters.variables)[i] 
				+ "' type='text'></td><td><input class='var_vol input_text' placeholder='Value' style='padding-top: 10px;' value='" 
				+ story_script.parameters.variables[Object.keys(story_script.parameters.variables)[i]] 
				+ "' type='text'></td><td onclick=\"var a = this.closest('tr'); a.parentElement.removeChild(a);\" style='width:40px; cursor:pointer;' title='delet "+Object.keys(story_script.parameters.variables)[i] +"' class='icon icon_del'></td></tr>";
		}
	}
	var_list += "</tbody></table><div onclick=\"add_tr('var_tablet')\" class='icon icon_add' style='margin:16px 0 0 45%;height: 26px; width: 26px; cursor:pointer;'></div>"
	var sound_list = "<table width='100%' id='var_sounds'><tbody>";
	if (story_script.parameters.sounds){
		for (i = 0; i < Object.keys(story_script.parameters.sounds).length; i++) {
			sound_list += "<tr><td style='padding-right:8px; border-right:1px solid #cec8e3; width:40%; padding-top: 10px;'><input class='sound_name input_text' placeholder='Name' value='" 
				+ Object.keys(story_script.parameters.sounds)[i] 
				+ "' type='text'></td><td><input class='sound_path input_text' placeholder='path to audio file' style='padding-top: 10px;' value='" 
				+ story_script.parameters.sounds[Object.keys(story_script.parameters.sounds)[i]] 
				+ "' type='text'></td><td onclick=\"var a = this.closest('tr'); a.parentElement.removeChild(a);\" style='width:40px; cursor:pointer;' title='delet "+Object.keys(story_script.parameters.sounds)[i]+"' class='icon icon_del'></td></tr>";
		}
	}
	sound_list += "</tbody></table><div onclick=\"add_tr('var_sounds')\" class='icon icon_add' style='margin:16px 0 0 45%;height: 26px; width: 26px; cursor:pointer;'></div>"
	var title_list = "<table width='100%' id='var_title'><tbody>";
	if (story_script.parameters.title){
		for (i = 0; i < Object.keys(story_script.parameters.title).length; i++) {
			title_list += "<tr><td style='padding-right:8px; border-right:1px solid #cec8e3; width:40%; padding-top: 10px;'><select class='input_text title_lang'>"
			var lang = '';
			for (l = 0; l < Object.keys(languares).length; l++) {
				lang += "<option value='"+languares[Object.keys(languares)[l]]+"' "+((languares[Object.keys(languares)[l]] == Object.keys(story_script.parameters.title)[i] )?"selected":"")+">"+ Object.keys(languares)[l]+"</option>"
			}
			title_list += lang + "</select></td><td><input class='title_name input_text' placeholder='translated title' style='padding-top: 10px;' value='" 
				+ story_script.parameters.title[Object.keys(story_script.parameters.title)[i]] 
				+ "' type='text'></td><td onclick=\"var a = this.closest('tr'); a.parentElement.removeChild(a);\" style='width:40px; cursor:pointer;' title='delet' class='icon icon_del'></td></tr>";
		}
	}
	var plugins_show = "<table id='plugin' style='width:100%; font-size: 14px; border-spacing:10px; border-collapse: separate;'>"
		var plugins_name
		for (i = 0; i < Object.keys(plugins_list).length; i++) {
			plugins_name = Object.keys(plugins_list)[i]
			plugins_show +=	"<tr><td align='right' style='padding-top:4px; height: 40px;'><input id='" + plugins_name + "' type='checkbox' class='chec_plugin checkbox_a' " + ((story_script.parameters.plugins.indexOf(plugins_name) > -1)?'checked':'') + "></td><td align='left' style='width:100%;'>" + plugins_list[plugins_name].name + " - " + plugins_list[plugins_name].text + "</td></tr>"
		}
	plugins_show +=	"</table>"
	
	title_list += "</tbody></table><div onclick=\"add_tr('var_title')\" class='icon icon_add' style='margin:16px 0 0 45%;height: 26px; width: 26px; cursor:pointer;'></div>"
	var html = "<div class='window' style='padding:24px 16px; width: 480px;'><div style'position:relative;'><div class='window_close icon icon_close' onclick='modal_window(\"close\")'></div></div><p>Settings project</p><br>"
	+"<table width='100%' style='height: 60vh; border-radius:8px; border-top:1px solid #cec8e3;'><tbody>"
	+"<tr><td id='set_1' onclick='set_menu(0)' align='right' class='set_button set_select'>General</td><td width='100%' valign='top' rowspan='6' style='position: relative;'>"
    //
	+"<div id='blank_0' style='visibility:visible;' class='set_blank'><table style='width:100%; font-size: 14px; border-spacing:10px; border-collapse: separate;'>"
	+"<tr><td align='right'>autosave </td><td align='left' style='padding-top:4px; width:60%;'><input id='autosave' type='checkbox' class='checkbox_a' " + ((story_script.parameters.autosave)?'checked':'') + "></td></tr>"
	+"<tr><td align='right'>story launch block </td><td align='left''>  <select class='input_text' id='launch_story'>"+((block_list)?block_list:'')+"</select></td></tr>"
	+"<tr><td align='right'>css styles file </td><td align='left'><input id='style_file' class='input_text' value='" + ((story_script.parameters.style_file)?story_script.parameters.style_file:'') + "' type='text'></td></tr>"
	+"<tr><td align='right'>font family </td><td align='left'><input id='font' class='input_text' value='" + ((story_script.parameters.font)?story_script.parameters.font:'') + "' type='text'></td></tr>"
	+"<tr><td align='right'>font size </td><td align='left'><input id='font_size' class='input_text' value='" + ((story_script.parameters.font_size)?story_script.parameters.font_size:'') + "' type='text'></td></tr>"
	+"</table><br><p align='left' style='font-size: 14px; margin-left:8px;'>name project</p><hr>" + title_list + "</div>"
	//
	+"<div id='blank_4' style='visibility:hidden;' class='set_blank'><table style='width:100%; font-size: 14px; border-spacing:10px; border-collapse: separate;'>"
    +"<tr><td align='right'>next </td><td align='left'><input id='key_next' class='input_text' onkeyup='this.value = event.code;' value='" + ((story_script.parameters.key.next)?story_script.parameters.key.next:'') + "' type='text'></td></tr>"
	+"<tr><td align='right'>back </td><td align='left'><input id='key_back' class='input_text' onkeyup='this.value = event.code;' value='" + ((story_script.parameters.key.back)?story_script.parameters.key.back:'') + "' type='text'></td></tr>"
	+"<tr><td align='right'>save stage</td><td align='left'><input id='key_save' class='input_text' onkeyup='this.value = event.code;' value='" + ((story_script.parameters.key.save)?story_script.parameters.key.save:'') + "' type='text'></td></tr>"
	+"<tr><td align='right'>load stage</td><td align='left'><input id='key_load' class='input_text' onkeyup='this.value = event.code;' value='" + ((story_script.parameters.key.load)?story_script.parameters.key.load:'') + "' type='text'></td></tr>"
    +"<tr><td align='right'>full screen </td><td align='left'><input id='key_full_screen' class='input_text' onkeyup='this.value = event.code;' value='" + ((story_script.parameters.key.full_screen)?story_script.parameters.key.full_screen:'') + "' type='text'></td></tr>"
    +"<tr><td align='right'>launch screen </td><td align='left'><input id='key_launch_story' class='input_text' onkeyup='this.value = event.code;' value='" + ((story_script.parameters.key.launch_story)?story_script.parameters.key.launch_story:'') + "' type='text'></td></tr>"
    +"<tr><td align='right'>load autosave </td><td align='left' style='width:60%;'><input id='key_load_autosave' class='input_text' onkeyup='this.value = event.code;' value='" + ((story_script.parameters.key.load_autosave)?story_script.parameters.key.load_autosave:'') + "' type='text'></td></tr>"
	+"</table></div>"
	//
	+"<div id='blank_3' style='visibility:hidden;' class='set_blank'>" + var_list + "</div>"
	+"<div id='blank_2' style='visibility:hidden;' class='set_blank'>" + sound_list + "</div>"
	+"<div id='blank_5' style='visibility:hidden;' class='set_blank'>Characters</div>"
	+"<div id='blank_1' style='visibility:hidden;' class='set_blank'>" + plugins_show + "</div>"
    //
	+"</td></tr>"
	+"<tr><td id='set_2' onclick='set_menu(1)' align='right' class='set_button'>Add-on</td></tr>"
	+"<tr><td id='set_3' onclick='set_menu(2)' align='right' class='set_button'>Sounds</td></tr>"
	+"<tr><td id='set_4' onclick='set_menu(3)' align='right' class='set_button'>Variables</td></tr>"
	+"<tr><td id='set_5' onclick='set_menu(4)' align='right' class='set_button'>Keyboard</td></tr>"
	+"<tr><td id='set_6' onclick='set_menu(5)' align='right' class='set_button' style='border-radius:0 0 0 16px;'>Characters</td></tr>"
	+"<tr><td style='border-right:1px solid #cec8e3;'></td></tr></tbody></table><br><table class='big_button' width='256px' onclick='apply_setup()'><tbody><tr><td width='42px' class='icon icon_ok'></td><td align='center'>Apply</td><td width='42px'></td></tr></tbody></table></div>"
	modal_window("open", html)
}
function set_menu(name) {
	var li = document.getElementsByClassName("set_button");
	for (var i = 0; i < li.length; i++) {
		if (i == name) {
			li[i].className = 'set_button set_select'
			document.getElementById('blank_'+i).style.visibility= 'visible';
		}
		else {
			li[i].className = 'set_button'
			document.getElementById('blank_'+i).style.visibility= 'hidden';
		}
	}
}
function add_tr(id){
	var tbody = document.getElementById(id).getElementsByTagName('tbody')[0];
	var row = document.createElement("tr");
	var td1 = document.createElement("td");
    var td2 = document.createElement("td");
	var td3 = document.createElement("td");
	if (id == 'var_title') {
		var lang = '';
		for (l = 0; l < Object.keys(languares).length; l++) {lang += "<option value='"+languares[Object.keys(languares)[l]]+"' >"+ Object.keys(languares)[l]+"</option>"}
		td1.innerHTML = "<select class='input_text title_lang'>" + lang + "</select>";
		td1.style = "padding-right:8px; border-right:1px solid #cec8e3; width:40%; padding-top: 10px;";
		td2.innerHTML = "<input class='title_name input_text' style='padding-top: 10px;' type='text' placeholder='translated title'>";
	} else if (id == 'var_tablet') {
		td1.innerHTML = "<input class='var_name input_text' placeholder='name' style='padding-top: 10px;' type='text'>";
		td1.style = "padding-right:8px; border-right:1px solid #cec8e3; width:40%;";
		td2.innerHTML = "<input class='var_vol input_text' style='padding-top: 10px;' type='text' placeholder='value'>";
	} else if (id == 'var_sounds') {
		td1.innerHTML = "<input class='sound_name input_text' placeholder='name' style='padding-top: 10px;' type='text'>";
		td1.style = "padding-right:8px; border-right:1px solid #cec8e3; width:40%;";
		td2.innerHTML = "<input class='sound_path input_text' style='padding-top: 10px;' type='text' placeholder='path to audio file'>";
	}
    td3.style = "width:40px; cursor:pointer;";
    td3.title = "delet";
    td3.className = "icon icon_del";
    td3.setAttribute("onclick","var a = this.closest('tr'); a.parentElement.removeChild(a);");
	row.appendChild(td1);
    row.appendChild(td2);
    row.appendChild(td3);
	tbody.appendChild(row);
}
function apply_setup(){
	var i, li_n, li_v;
	story_script.parameters.launch_story = document.getElementById('launch_story').value
	story_script.parameters.style_file = document.getElementById('style_file').value
	story_script.parameters.autosave = document.getElementById('autosave').checked
    story_script.parameters.key.next = document.getElementById('key_next').value
    story_script.parameters.key.back = document.getElementById('key_back').value
    story_script.parameters.key.save = document.getElementById('key_save').value
    story_script.parameters.key.load = document.getElementById('key_load').value
    story_script.parameters.key.full_screen = document.getElementById('key_full_screen').value
    story_script.parameters.key.launch_story = document.getElementById('key_launch_story').value
    story_script.parameters.key.load_autosave = document.getElementById('key_load_autosave').value
	story_script.parameters.font = document.getElementById('font').value
	story_script.parameters.font_size = document.getElementById('font_size').value
	//
    i;
	li_n = document.getElementsByClassName("var_name");
	li_v = document.getElementsByClassName("var_vol");
	story_script.parameters.variables = {};
	for (i = 0; i < li_n.length; i++) {
		if(li_n[i].value != ""){story_script.parameters.variables[li_n[i].value] = li_v[i].value}
	}
	li_n = document.getElementsByClassName("sound_name");
	li_v = document.getElementsByClassName("sound_path");
	story_script.parameters.sounds = {};
	for (i = 0; i < li_n.length; i++) {
		if(li_n[i].value != ""){story_script.parameters.sounds[li_n[i].value] = li_v[i].value}
	}
	li_n = document.getElementsByClassName("title_lang");
	li_v = document.getElementsByClassName("title_name");
	story_script.parameters.title = {};
	story_script.parameters.languares = [];
	for (i = 0; i < li_n.length; i++) {
		story_script.parameters.title[li_n[i].value] = li_v[i].value
		story_script.parameters.languares.push(li_n[i].value); 
	}
	li_v = document.getElementsByClassName("chec_plugin");
	story_script.parameters.plugins = [];
	for (i = 0; i < li_v.length; i++) {
		if (li_v[i].checked) {story_script.parameters.plugins.push(li_v[i].id);}
	}
	modal_window('close')
}
</script>
</body>
</html>
